{% extends 'core/base.html' %}

{% block title %}Update Contact{% endblock title %}

{% block body %}
<div class="container-fluid py-5 bg-light">
    {% if request.user.is_authenticated %}
        <!-- Authenticated User Section -->
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-10">
                <div class="card shadow-lg border-0 rounded-4">
                    <div class="card-header bg-gradient-primary text-white text-center py-4 rounded-top-4">
                        <h2 class="mb-0 fw-bold">
                            <i class="fas fa-user-edit me-2"></i>
                            Update Contact
                        </h2>
                        <p class="mb-0 mt-2 opacity-75">Modify the contact details below</p>
                    </div>
                    
                    <div class="card-body p-5">
                        <form method="post" action="" novalidate>
                            {% csrf_token %}
                            
                            <!-- Non-field errors -->
                            {% if form.non_field_errors %}
                                <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Error!</strong>
                                    {% for error in form.non_field_errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endif %}

                            <!-- Form Fields -->
                            {% for field in form %}
                                <div class="mb-4">
                                    <label for="{{ field.id_for_label }}" class="form-label fw-semibold">
                                        <i class="fas {{ field.label|lower|slugify|add:'-icon' }} me-2 text-primary"></i>
                                        {{ field.label }}
                                    </label>
                                    <div class="input-group">
                                        {{ field }}
                                    </div>
                                    {% if field.help_text %}
                                        <div class="form-text text-muted">{{ field.help_text }}</div>
                                    {% endif %}
                                    {% if field.errors %}
                                        <div class="invalid-feedback d-block">
                                            <i class="fas fa-exclamation-circle me-1"></i>
                                            {{ field.errors.0 }}
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}

                            <!-- Submit and Back Buttons -->
                            <div class="d-grid gap-3">
                                <button type="submit" class="btn btn-primary btn-lg py-3 fw-semibold">
                                    <i class="fas fa-save me-2"></i>
                                    Update Contact
                                </button>
                                <a href="{% url 'contact' %}" class="btn btn-outline-secondary btn-lg py-3">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Back to Contacts
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    {% else %}
        <!-- Not Authenticated Section -->
        <div class="row justify-content-center align-items-center" style="min-height: 70vh;">
            <div class="col-lg-5 col-md-7 col-sm-9">
                <div class="card shadow-lg border-0 rounded-4">
                    <div class="card-body p-5 text-center">
                        <!-- Lock Icon with Animation -->
                        <div class="mb-4">
                            <div class="auth-icon-wrapper">
                                <i class="fas fa-lock fa-4x text-primary mb-3"></i>
                                <div class="pulse-ring"></div>
                            </div>
                        </div>
                        
                        <!-- Header -->
                        <h2 class="card-title mb-3 text-dark fw-bold">Access Restricted</h2>
                        <p class="card-text text-muted mb-4 lead">
                            Please sign in to update contact information.
                        </p>
                        
                        <!-- Action Buttons -->
                        <div class="d-grid gap-3">
                            <a href="{% url 'login' %}" class="btn btn-primary btn-lg py-3 fw-semibold">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                Sign In
                            </a>
                            <div class="text-center">
                                <span class="text-muted">New here?</span>
                                <a href="{% url 'register' %}" class="btn btn-outline-success btn-lg ms-2">
                                    <i class="fas fa-user-plus me-2"></i>
                                    Create Account
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<!-- Custom Styles -->
<style>
    /* General Layout */
    body {
        background-color: #f5f7fa;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    .container-fluid {
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Card Styling */
    .card {
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background: #ffffff;
    }

    .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .card-header.bg-gradient-primary {
        background: linear-gradient(45deg, #0d6efd, #3b82f6);
        border-radius: 12px 12px 0 0;
        padding: 2rem;
    }

    /* Form Styling */
    .form-label {
        color: #1f2a44;
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
    }

    .form-control,
    .form-select {
        border-radius: 10px;
        border: 1px solid #d1d5db;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: all 0.2s ease;
        background: #f8fafc;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        background: #ffffff;
    }

    .input-group {
        position: relative;
    }

    .invalid-feedback {
        font-size: 0.875rem;
        color: #dc3545;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
    }

    .form-text {
        font-size: 0.875rem;
        color: #6b7280;
    }

    /* Buttons */
    .btn-primary {
        background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        border: none;
        border-radius: 10px;
        padding: 0.85rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        background: linear-gradient(45deg, #2563eb, #1e40af);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-outline-secondary,
    .btn-outline-success {
        border-radius: 10px;
        padding: 0.85rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover,
    .btn-outline-success:hover {
        transform: translateY(-2px);
    }

    /* Alert Styling */
    .alert {
        border-radius: 10px;
        padding: 1rem 1.5rem;
        background: #fee2e2;
        border: 1px solid #f87171;
    }

    .alert .btn-close {
        padding: 1rem;
    }

    /* Authentication Section */
    .auth-icon-wrapper {
        position: relative;
        display: inline-block;
    }

    .pulse-ring {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        border: 3px solid #3b82f6;
        border-radius: 50%;
        opacity: 0.6;
        animation: pulse 2.5s ease-in-out infinite;
    }

    @keyframes pulse {
        0% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.6;
        }
        50% {
            transform: translate(-50%, -50%) scale(1.3);
            opacity: 0.2;
        }
        100% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.6;
        }
    }

    /* Icon Mapping for Fields */
    .name-icon::before { content: '\f007'; } /* fa-user */
    .email-icon::before { content: '\f0e0'; } /* fa-envelope */
    .phone-icon::before { content: '\f095'; } /* fa-phone */
    .category-icon::before { content: '\f02c'; } /* fa-tags */
    .address-icon::before { content: '\f3c5'; } /* fa-map-marker-alt */

    /* Responsive Design */
    @media (max-width: 768px) {
        .card-body {
            padding: 1.5rem;
        }

        .card-header {
            padding: 1.5rem;
        }

        .btn-lg {
            padding: 0.75rem 1rem;
        }

        .form-control,
        .form-select {
            font-size: 0.95rem;
        }
    }

    /* Accessibility */
    .form-control::placeholder {
        color: #6b7280;
        opacity: 1;
    }

    a:focus,
    button:focus {
        outline: 3px solid #3b82f6;
        outline-offset: 2px;
    }
</style>
{% endblock body %}